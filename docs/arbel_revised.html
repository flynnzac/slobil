<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-09-12 Sat 13:51 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ARBEL</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Zach Flynn" />
<meta name="description" content="ARBEL is a registry-based environment and language."
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="preamble" class="status">
ARBEL<br>Zach Flynn<br>2020-09-12 Sat 13:51
</div>
<div id="content">
<h1 class="title">ARBEL</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0ee8739">1. Introduction to ARBEL</a></li>
<li><a href="#org92b5846">2. Elements of ARBEL</a></li>
<li><a href="#org90c7b9f">3. Syntax</a>
<ul>
<li><a href="#org1bf33ed">3.1. Literals and Names</a>
<ul>
<li><a href="#orgd36823a">3.1.1. Numeric Literals</a></li>
<li><a href="#org4202e0b">3.1.2. String Literals</a></li>
<li><a href="#orgfb0111a">3.1.3. Boolean Literals</a></li>
<li><a href="#org166b164">3.1.4. Register Literals</a></li>
<li><a href="#org6b077a2">3.1.5. Instruction Literals</a></li>
<li><a href="#org8737f1d">3.1.6. Operator Literals</a></li>
<li><a href="#orgf296b27">3.1.7. The Nothing Literal</a></li>
</ul>
</li>
<li><a href="#orgcb75531">3.2. Substatements</a>
<ul>
<li><a href="#org4b0b1c6">3.2.1. Immediate Substatements</a></li>
<li><a href="#org8271968">3.2.2. Active Instructions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org91fbd62">4. Registries</a>
<ul>
<li><a href="#org9e10cf3">4.1. Registries as data structures</a></li>
<li><a href="#org590fe01">4.2. Registries as environments</a></li>
</ul>
</li>
<li><a href="#org2d5e279">5. Registers</a></li>
<li><a href="#orgc7ea2e9">6. Instructions</a>
<ul>
<li><a href="#org1449529">6.1. In operation</a></li>
<li><a href="#orgcae1443">6.2. Call operation</a></li>
<li><a href="#orgf55f55a">6.3. The collapse and do operations</a></li>
<li><a href="#orgab029d3">6.4. Defining operations</a></li>
</ul>
</li>
<li><a href="#org17ae4d6">7. Booleans and Control Flow</a>
<ul>
<li><a href="#org42397df">7.1. The if operation</a></li>
<li><a href="#orgb3b0931">7.2. The while operation</a></li>
<li><a href="#org1183cb9">7.3. Logical concatenation</a></li>
</ul>
</li>
<li><a href="#org14895f4">8. Numbers</a>
<ul>
<li><a href="#org45597de">8.1. Arithmetic</a></li>
<li><a href="#org662811d">8.2. Comparison</a></li>
<li><a href="#org391f91f">8.3. Exponentiation</a></li>
<li><a href="#org60acc39">8.4. Modulus</a></li>
<li><a href="#org9cb1391">8.5. Increment and Decrement</a></li>
</ul>
</li>
<li><a href="#org102a4da">9. Strings</a>
<ul>
<li><a href="#orgb3ef151">9.1. String manipulation</a></li>
<li><a href="#org852202b">9.2. Regular expressions</a></li>
</ul>
</li>
<li><a href="#org5dc0f50">10. Files</a></li>
<li><a href="#org8446b38">11. Tasks (concurrent programs)</a></li>
<li><a href="#org44c23b3">12. Interacting with the User and the Shell</a></li>
<li><a href="#orgcf02e86">13. Examples</a>
<ul>
<li><a href="#org90fa2ab">13.1. Quicksort</a></li>
<li><a href="#org1bc66cd">13.2. A Line-Oriented Text Editor</a></li>
<li><a href="#org75981f5">13.3. Numerical Differentiation</a></li>
<li><a href="#org16271c2">13.4. Compute Factorial</a></li>
<li><a href="#org78d54fa">13.5. Numerical Integration</a></li>
<li><a href="#orga852616">13.6. Basic Linear Algebra</a></li>
<li><a href="#org48bce83">13.7. Split a String</a></li>
<li><a href="#org06fad91">13.8. Linking C code</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org0ee8739" class="outline-2">
<h2 id="org0ee8739"><span class="section-number-2">1</span> Introduction to ARBEL</h2>
<div class="outline-text-2" id="text-1">
<p>
ARBEL is a programming system focused on being useful interactively.  ARBEL programs are a set of instructions that a user can use from the ARBEL environment.  It is centered around its REPL and provides commands to save the state of the REPL and keep logs of sessions.  The REPL can even be controlled via sockets.  
</p>

<p>
Everything in ARBEL is data, including the scope in which code is executed.  "Data sets" called registries in ARBEL determine what variables are available to ARBEL code at any given time. Registries are flexible tables containing data located at <i>registers</i>.  These data locations are themselves data which enables many simple optimizations such as moving data between registers without copying. Registries function both as the scope of code and are the main data structure in ARBEL.
</p>
</div>
</div>

<div id="outline-container-org92b5846" class="outline-2">
<h2 id="org92b5846"><span class="section-number-2">2</span> Elements of ARBEL</h2>
<div class="outline-text-2" id="text-2">
<p>
When you start ARBEL, you are greeted by the prompt.
</p>
<div class="org-src-container">
<pre class="src src-arbel">...
</pre>
</div>

<p>
Initially, the code you enter at this prompt is executed in the <i>root</i> registry.  Later, it may be executed in other registries.
</p>

<p>
An ARBEL statement with no substatements has a highly regular structure.  It consists of a number of data values each separated by whitespace ending with a period (separated from the last data element by whitespace as well).
</p>
<div class="org-src-container">
<pre class="src src-arbel">... data1 data2 data3 data4 .
</pre>
</div>

<p>
The first element in an ARBEL statement is always an <i>operation</i>, except for one exception made for convenience discussed shortly.  Operations perform actions using the data elements.
</p>

<p>
The first element can also be an <i>instruction</i> which is the data type containing arbitrary code.  Similarly, instructions perform actions using the data elements when they are used in this way, but they are more flexible than operations and can be used for other tasks as well.
</p>

<p>
ARBEL code is executed inside a data set called a registry.  Registries are tables with values entered in <i>registers</i>. The programmer enters commands to modify the contents of the registry and possibly send the results of any computations performed on the data to another registry.
</p>

<p>
Code in ARBEL has no context or scope of its own.  It requires a registry to give it context.  For example,
</p>
<div class="org-src-container">
<pre class="src src-arbel">... print x .
</pre>
</div>

<p>
requires that the registry contains data located at the <code>print</code> and <code>x</code> register.  Different registries could contain different values at these locations so the same code might perform different actions in different contexts.  
</p>
</div>
</div>

<div id="outline-container-org90c7b9f" class="outline-2">
<h2 id="org90c7b9f"><span class="section-number-2">3</span> Syntax</h2>
<div class="outline-text-2" id="text-3">
<p>
A single line of ARBEL code is a statement. Each statement contains a series of data values, either literals or locations to look for data, separated by whitespace and ending with a period.  All elements of a statement must be separated by whitespace from the preceding element, including the terminating period.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... data1 data2 data3 data4 .
</pre>
</div>

<p>
The following are examples of statements:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... add 1 2 .
ans = 3
... print <span style="color: #4E9A06;">"Hello"</span> .
Hello
</pre>
</div>

<p>
The first element of a statement is an operation that performs some transformation of the other data elements in the statement and the contents of the registry in which the statement is executed.  The first statement uses the operation located at the <code>add</code> register.  The second uses the operation located at the <code>add</code> register.  The numbers and the the string <code>"Hello"</code> are literals.
</p>
</div>

<div id="outline-container-org1bf33ed" class="outline-3">
<h3 id="org1bf33ed"><span class="section-number-3">3.1</span> Literals and Names</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Names are sequences of characters that are not literals and not parenthesis (<code>()</code>, <code>[]</code>, <code>{}</code>, <code>&lt;&gt;</code>).  A name appearing in a statement indicates the value located at the register with that name.
</p>

<p>
Literals represent a value of data.
</p>
</div>

<div id="outline-container-orgd36823a" class="outline-4">
<h4 id="orgd36823a"><span class="section-number-4">3.1.1</span> Numeric Literals</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Numbers are a sequence of digits either with or without a decimal point.  With a decimal point, the type of the literal is a Real.  Without a decimal point, the type of the literal is an Integer. Example: <code>123</code> and <code>1.23</code>.
</p>
</div>
</div>

<div id="outline-container-org4202e0b" class="outline-4">
<h4 id="org4202e0b"><span class="section-number-4">3.1.2</span> String Literals</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Strings are a sequence of characters enclosed by double quotes (<code>""</code>). Example: <code>"Hello, world."</code>.  
</p>
</div>
</div>

<div id="outline-container-orgfb0111a" class="outline-4">
<h4 id="orgfb0111a"><span class="section-number-4">3.1.3</span> Boolean Literals</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Boolean literals are one of two words: <code>True</code> and <code>False</code> (case sensitive).  
</p>
</div>
</div>

<div id="outline-container-org166b164" class="outline-4">
<h4 id="org166b164"><span class="section-number-4">3.1.4</span> Register Literals</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
A register location is a name preceeded by a forward slash <code>/</code>.  Example: <code>/hello</code>, <code>/x1</code>.  These literals refer to the register location, not its value.  Almost any string of characters is a valid register location, but some will be less convenient to access because they collide with other elements of ARBEL's syntax.  But they can still be used.  For example,
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/.</span> 1 .
... get <span style="color: #0084C8; font-weight: bold;">/.</span> .
ans = 1
</pre>
</div>

<p>
Can be used to access the value when the register's value cannot be accessed in the usual way, by omitting the forward slash.
</p>
</div>
</div>

<div id="outline-container-org6b077a2" class="outline-4">
<h4 id="org6b077a2"><span class="section-number-4">3.1.5</span> Instruction Literals</h4>
<div class="outline-text-4" id="text-3-1-5">
<p>
Instructions are ARBEL statements enclosed in open parenthesis.  Instructions are code that is not executed but saved as data to be used in another environment.  Example: <code>( add t 2 . mul ans 5 . )</code> which is an instruction to add <code>2</code> to the value at a register <code>/t</code> and multiply the answer by <code>5</code>. This code is not executed and resolves to a type of data called an Instruction.  It is treated as a literal value.  The whitespace following the first parenthesis and preceeding the last is required.
</p>
</div>
</div>

<div id="outline-container-org8737f1d" class="outline-4">
<h4 id="org8737f1d"><span class="section-number-4">3.1.6</span> Operator Literals</h4>
<div class="outline-text-4" id="text-3-1-6">
<p>
Operations are like instructions except that they are less flexible because they must be called in a certain way with fixed positional arguments.  Operation literals are enclosed in angle brackets (<code>&lt;&gt;</code>) like so: <code>&lt; ( add t 1 . ) /t &gt;</code>.  The first element inside the angle brackets is an instruction.  The rest of the arguments are registers which give the data locations to bind the operator's arguments to when called so that: <code>&lt; ( add t 1 . ) /t &gt; 10 .</code> would give <code>11</code>.  These values are treated as literals of the Operation type.
</p>
</div>
</div>

<div id="outline-container-orgf296b27" class="outline-4">
<h4 id="orgf296b27"><span class="section-number-4">3.1.7</span> The Nothing Literal</h4>
<div class="outline-text-4" id="text-3-1-7">
<p>
The word <code>Nothing</code> is a literal value of type <code>Nothing</code>.  <code>Nothing</code> is not like other data types.  That is the most important thing about it.  It can be used as the return value for errors and other situations.
</p>
</div>
</div>
</div>

<div id="outline-container-orgcb75531" class="outline-3">
<h3 id="orgcb75531"><span class="section-number-3">3.2</span> Substatements</h3>
<div class="outline-text-3" id="text-3-2">
<p>
ARBEL statements can contain two forms of substatements in place of a data element.  The substatements differ by when the code they contain is executed.  
</p>
</div>

<div id="outline-container-org4b0b1c6" class="outline-4">
<h4 id="org4b0b1c6"><span class="section-number-4">3.2.1</span> Immediate Substatements</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Immediate substatements are executed as soon as they are encountered.  They evaluate to the value of the <code>ans</code> register in the registry where the code is executed after the substatement is executed. They are enclosed in square brackets.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... add [ sub 5 3 . ] 10 .
ans = 12
</pre>
</div>

<p>
<code>sub</code> is the usual location of the subtraction operator.  The bracketed substatement is evaluated and replaced with the value of the <code>ans</code> register after <code>sub 5 3 .</code> is executed.   The subtraction and other arithmetic operations set the <code>ans</code> register to their result.  So <code>2</code> is the first data element in the outer statement.  <code>add</code> then adds <code>2</code> and <code>10</code> setting the <code>ans</code> register to <code>12</code>.
</p>
</div>
</div>

<div id="outline-container-org8271968" class="outline-4">
<h4 id="org8271968"><span class="section-number-4">3.2.2</span> Active Instructions</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Active instructions are executed <i>when they are used</i>.  They are usually used in conditional operations so that code is not executed unless it is required.  They are enclosed in curly braces.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... if <span style="color: #F5666D;">True</span> { print <span style="color: #4E9A06;">"hello"</span> . } { print <span style="color: #4E9A06;">"goodbye"</span> . } .
hello
... if <span style="color: #F5666D;">False</span> { print <span style="color: #4E9A06;">"hello"</span> . } { print <span style="color: #4E9A06;">"goodbye"</span> . } .
goodbye
... if <span style="color: #F5666D;">True</span> [ print <span style="color: #4E9A06;">"hello"</span> . ] [ print <span style="color: #4E9A06;">"goodbye"</span> . ]
hello
goodbye
</pre>
</div>

<p>
This code block illustrates the difference between active instructions and immediate substatements.  The <code>if</code> operation accesses and returns its second argument if the first argument is <code>True</code> and the third argument if the first is <code>False</code>.  So, only the first active instruction is executed in the first line of code and only the second active instruction is executed in the second line.  The third line uses immediate substatements instead.  These are executed as soon as they are encountered regardless of whether the <code>if</code> operation accesses their value.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org91fbd62" class="outline-2">
<h2 id="org91fbd62"><span class="section-number-2">4</span> Registries</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org9e10cf3" class="outline-3">
<h3 id="org9e10cf3"><span class="section-number-3">4.1</span> Registries as data structures</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Registries are tables of data located at registers.  Register locations are prefixed with a forward slash in ARBEL so:
</p>
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #0084C8; font-weight: bold;">/hello</span>
<span style="color: #0084C8; font-weight: bold;">/x</span>
<span style="color: #0084C8; font-weight: bold;">/z123</span>
</pre>
</div>

<p>
are all examples of register locations in ARBEL.  The value located at a registry is referenced by removing the forward slash.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
... print x .
10
</pre>
</div>

<p>
The <code>set</code> operation assigns a value to a register. Values can also be retrieved from registries using the <code>get</code> operation:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
... get <span style="color: #0084C8; font-weight: bold;">/x</span> .
ans = 10
</pre>
</div>

<p>
The <code>move</code> operation moves values between registers without copying the underlying data.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
... print x .
10
... move <span style="color: #0084C8; font-weight: bold;">/x</span> <span style="color: #0084C8; font-weight: bold;">/y</span> .
... print x .
Error: Value at register <span style="color: #0084C8; font-weight: bold;">/x</span> not found.
... print y .
10
</pre>
</div>

<p>
The <code>delete</code> operation deletes a value from a given register in the current registry.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
... print x .
10
... delete <span style="color: #0084C8; font-weight: bold;">/x</span> .
... print x .
Error: Value not found at <span style="color: #0084C8; font-weight: bold;">/x</span> register.
</pre>
</div>

<p>
The <code>registry</code> operation creates a new registry.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... registry <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
ans = a registry with:
x of type Integer, value: 10
</pre>
</div>

<p>
The <code>registry</code> operation takes a series of register value pairs as input and creates a registry with each value stored at each register.  After a new registry is created, values can be set and retrieved from the registry using the <code>set</code> and <code>get</code> operation's optional final argument.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry <span style="color: #0084C8; font-weight: bold;">/x</span> 10 . ] .
... get <span style="color: #0084C8; font-weight: bold;">/x</span> r .
ans = 10
... set <span style="color: #0084C8; font-weight: bold;">/y</span> 4 r .
... get <span style="color: #0084C8; font-weight: bold;">/y</span> r .
ans = 4
</pre>
</div>

<p>
Values in other registries can also be accessed by using the colon syntax.  The value located at a certain register in another registry can be written as:
</p>
<div class="org-src-container">
<pre class="src src-arbel">registry:register
</pre>
</div>

<p>
For example,
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry <span style="color: #0084C8; font-weight: bold;">/x</span> 10 . ] .
... print r:<span style="color: #0084C8; font-weight: bold;">/x</span> .
10
... set <span style="color: #0084C8; font-weight: bold;">/y</span> <span style="color: #0084C8; font-weight: bold;">/x</span> .
... print r:y .
10
</pre>
</div>

<p>
This notation can be nested.  So a value in a registry located at a register inside another registry can be accessed with:
</p>
<div class="org-src-container">
<pre class="src src-arbel">registry:register:register
</pre>
</div>

<p>
Where the first register is the location of another registry inside the registry.  Like so,
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry <span style="color: #0084C8; font-weight: bold;">/s</span> [ registry <span style="color: #0084C8; font-weight: bold;">/x</span> 10 . ] . ] .
... print r:<span style="color: #0084C8; font-weight: bold;">/s:/x</span> .
10
</pre>
</div>

<p>
Elements of a registry can be selected using the <code>find</code> operation.  The find operation takes a registry and an operation as arguments.  The operation should take two arguments.  The first is a value in the registry.  The second is the register the value is located at in the registry.  If the element should be selected, the operation should set the <code>/ans</code> register to <code>True</code>.  If it should not be, the operation should set the <code>/ans</code> register to <code>False</code>.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ list 4 2 3 <span style="color: #4E9A06;">"hello"</span> . ] .
... print r .
ans = a registry with:
t1 of type Integer, value: 4
t2 of type Integer, value: 2
t3 of type Integer, value: 3
t4 of type String, value: <span style="color: #4E9A06;">"hello"</span>
... find r <span style="color: #00578E; font-weight: bold;">&lt;</span> ( is-integer value . ) <span style="color: #0084C8; font-weight: bold;">/value</span> <span style="color: #0084C8; font-weight: bold;">/key</span> <span style="color: #00578E; font-weight: bold;">&gt;</span> .
ans = a registry with:
t1 of type Integer, value: 4
t2 of type Integer, value: 2
t3 of type Integer, value: 3
</pre>
</div>

<p>
The <code>import</code> operation is used to take the objects from one registry and add them to another. 
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry <span style="color: #0084C8; font-weight: bold;">/x</span> 10 . ] .
... print x .
Error: Value not found at register <span style="color: #0084C8; font-weight: bold;">/x.</span>
... import r .
... print x .
10
</pre>
</div>

<p>
<code>exist</code> checks whether a value is located in a registry.  It sets the <code>/ans</code> register to <code>True</code> if it is and to <code>False</code> if it does not.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
... exist <span style="color: #0084C8; font-weight: bold;">/x</span> .
ans = <span style="color: #F5666D;">True</span>
... delete <span style="color: #0084C8; font-weight: bold;">/x</span> .
... exist <span style="color: #0084C8; font-weight: bold;">/x</span> .
ans = <span style="color: #F5666D;">False</span>
... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry <span style="color: #0084C8; font-weight: bold;">/z</span> 50 . ] .
... exist <span style="color: #0084C8; font-weight: bold;">/z</span> r .
ans = <span style="color: #F5666D;">True</span>
... exist <span style="color: #0084C8; font-weight: bold;">/z</span> .
ans = <span style="color: #F5666D;">False</span> 
</pre>
</div>
</div>
</div>

<div id="outline-container-org590fe01" class="outline-3">
<h3 id="org590fe01"><span class="section-number-3">4.2</span> Registries as environments</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Registries are both a data structure as described above, and an environment in which code is executed.  To change which registry code is being executed in, use the <code>go-in</code> operation to change the current registry to another registry.  Use the <code>go-out</code> operation to move up to the previous registry.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... <span style="color: #0084C8; font-weight: bold;">/set</span> <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry . ] .
... go-in r .
... set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
... print x .
10
... go-out .
... print x .
Error: Value not found at <span style="color: #0084C8; font-weight: bold;">/x</span> register.
... print r:<span style="color: #0084C8; font-weight: bold;">/x</span> .
10
</pre>
</div>


<p>
An instruction can also be executed in a registry using the <code>in</code> operation.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ registry <span style="color: #0084C8; font-weight: bold;">/t</span> 1 . ] .
... print r:<span style="color: #0084C8; font-weight: bold;">/t</span> .
1
... in r ( move <span style="color: #0084C8; font-weight: bold;">/t</span> <span style="color: #0084C8; font-weight: bold;">/s</span> . ) .
... print r:<span style="color: #0084C8; font-weight: bold;">/s</span> .
1
... print s .
Error: No value found at register <span style="color: #0084C8; font-weight: bold;">/s.</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2d5e279" class="outline-2">
<h2 id="org2d5e279"><span class="section-number-2">5</span> Registers</h2>
<div class="outline-text-2" id="text-5">
<p>
Registers are a full-fledged data type.  Register locations can be inserted into a registry.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> <span style="color: #0084C8; font-weight: bold;">/y</span> .
... set x 10 .
... print x .
<span style="color: #0084C8; font-weight: bold;">/y</span>
... print y .
10
</pre>
</div>

<p>
Registries with an array-like structure often have registers with names like: <code>/r1,/r2,/r3</code>.  ARBEL has convenience operations to work with registers like these.
</p>

<p>
<code>list</code> creates registries where each element is at register location <code>/t1,/t2,/t3,...</code>.  
</p>
<div class="org-src-container">
<pre class="src src-arbel">... list 1 2 3 .
ans = a registry with:
t1 of type Integer, value: 1
t2 of type Integer, value: 2
t3 of type Integer, value: 3
</pre>
</div>

<p>
<code>next</code> and <code>previous</code> set the <code>/ans</code> register to the next or previous register for registers that end in numeric values.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... next <span style="color: #0084C8; font-weight: bold;">/element10</span> .
ans = <span style="color: #0084C8; font-weight: bold;">/element11</span>
... previous <span style="color: #0084C8; font-weight: bold;">/element10</span> .
ans = <span style="color: #0084C8; font-weight: bold;">/element9</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-orgc7ea2e9" class="outline-2">
<h2 id="orgc7ea2e9"><span class="section-number-2">6</span> Instructions</h2>
<div class="outline-text-2" id="text-6">
<p>
Instructions are code literals.  In syntax, they are statements enclosed in open parenthesis. Instructions can be executed with either the <code>in</code> or the <code>call</code> operations and they are often used as arguments for various operations like loops.  
</p>
</div>

<div id="outline-container-org1449529" class="outline-3">
<h3 id="org1449529"><span class="section-number-3">6.1</span> In operation</h3>
<div class="outline-text-3" id="text-6-1">
<p>
The <code>in</code> operation executes the instruction inside an existing registry.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/assign-x</span> ( set <span style="color: #0084C8; font-weight: bold;">/x</span> 10 . ) .
... set <span style="color: #0084C8; font-weight: bold;">/y</span> [ registry . ] .
... in y assign-x .
... print x .
Error: Value at register <span style="color: #0084C8; font-weight: bold;">/x</span> not found.
... in _ assign-x .
... print x .
10
</pre>
</div>

<p>
This example demonstrates both using instructions and how ARBEL code executes inside registries.  The <code>registry</code> operation creates a new registry.  The statement <code>in y assign-x</code> executes the code in the instruction located at <code>/assign-x</code> in the context of the <code>y</code> register.  So, within the <code>y</code> registry, the value located at <code>/x</code> is <code>10</code>.  But, because we are currently not inside the <code>/y</code> registry, after the <code>in</code> command we cannot access those registries so <code>print x</code> prints nothing.  The special name <code>_</code> refers to the current registry.  So <code>in _ assign-x</code> runs the instruction <code>assign-x</code> in the current registry.  So <code>/x</code> in the current registry now holds the value <code>10</code>.
</p>
</div>
</div>

<div id="outline-container-orgcae1443" class="outline-3">
<h3 id="orgcae1443"><span class="section-number-3">6.2</span> Call operation</h3>
<div class="outline-text-3" id="text-6-2">
<p>
The <code>call</code> operation executes the instruction inside a temporary registry defined by the user calling the code.  It then sets the <code>/ans</code> register in the calling registry to the value of the <code>/ans</code> register in the temporary registry.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/add-one</span> ( add t 1 . ) .
... call add-one <span style="color: #0084C8; font-weight: bold;">/t</span> 10 .
ans = 11
</pre>
</div>

<p>
The <code>call</code> operations takes an instruction and then alternating register value pairs as arguments.  The register value pairs define the state of the temporary registry when the code is run.  Because the caller of the code defines the state of the registry, any non-literal can be modified by the caller.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/add-one</span> ( add t 1 . ) .
... call add-one <span style="color: #0084C8; font-weight: bold;">/t</span> 10 .
ans = 11
... call add-one <span style="color: #0084C8; font-weight: bold;">/t</span> 10 <span style="color: #0084C8; font-weight: bold;">/add</span> sub .
ans = 9
</pre>
</div>

<p>
The second line typically located at the register <code>/add</code> (the <code>add</code> operation) with the operation located at the register <code>/sub</code> (the <code>sub</code> operation).  But it only makes this replacement in the temporary registry.  The registry calling the code is unaffected by this change.  So <code>call add-one /t 10 /add sub</code> subtracts <code>1</code> from <code>10</code> instead of adds.
</p>

<p>
The main difference between the <code>in</code> and <code>call</code> operation is that the <code>call</code> operation moves the value of <code>/ans</code> in the temporary registry it creates back to the calling registry.  The <code>in</code> operation is typically used for modifying registries and the <code>call</code> operation is typically used for computations.
</p>

<p>
As a convenience, if an instruction is the first data object in a statement, ARBEL assumes that you want to <code>call</code> it.  It operates exactly the same as if you had included the <code>call</code> operation itself.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/add-one</span> ( add t 1 . ) .
... add-one <span style="color: #0084C8; font-weight: bold;">/t</span> 10
ans = 10
</pre>
</div>

<p>
<code>answer</code> is a useful operation when calling instructions.  <code>answer</code> sets the <code>/ans</code> register to whatever argument is provided to the operation.  It highlights that the data is being returned to the registry that called the operation, but <code>answer DATA</code> is functionally equivalent to <code>set /ans DATA</code>.
</p>
</div>
</div>

<div id="outline-container-orgf55f55a" class="outline-3">
<h3 id="orgf55f55a"><span class="section-number-3">6.3</span> The collapse and do operations</h3>
<div class="outline-text-3" id="text-6-3">
<p>
The <code>collapse</code> and <code>do</code> operations iterate over the elements of a registry and create a new registry.  
</p>

<p>
The <code>collapse</code> operation aggregates over data at a number of registries.  Collapse makes use of a special structure put on the registry where some registers have the form <code>/prefixNNN...N</code>  where <code>NNN...N</code> is a natural number.  The <code>list</code> operation creates a registry with this form where the prefix is <code>t</code>.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/r</span> [ list 1 2 3 . ] .
... print r .
ans = a registry with:
t1 of type Integer, value: 1
t2 of type Integer, value: 2
t3 of type Integer, value: 3
... collapse add r <span style="color: #0084C8; font-weight: bold;">/t</span> .
ans = 6
</pre>
</div>

<p>
The <code>collapse</code> operation takes an operation that takes (at least) two arguments as its first argument.  Elements of the registry provided in the second argument that match the prefix provided in the third argument are fed in sequentially to the operation.  The collapse operation does the equivalent of:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... add r:<span style="color: #0084C8; font-weight: bold;">/t1</span> r:<span style="color: #0084C8; font-weight: bold;">/t2</span> .
ans = 3
... add ans r:<span style="color: #0084C8; font-weight: bold;">/t3</span> .
ans = 6
</pre>
</div>

<p>
The <code>do</code> operation applies another operation to all elements in a registry.
</p>
</div>
</div>

<div id="outline-container-orgab029d3" class="outline-3">
<h3 id="orgab029d3"><span class="section-number-3">6.4</span> Defining operations</h3>
<div class="outline-text-3" id="text-6-4">
<p>
Most new procedures that a programmer writes in ARBEL are instructions, but it is sometimes useful to have "positional" arguments like operations.  Users write operations by writing instructions and assigning argument numbers to different registers in the temporary registry. They can be defined using angle brackets or the <code>op</code> operation.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/add-one</span> [ op ( add t 1 . ) <span style="color: #0084C8; font-weight: bold;">/t</span> . ] .
... add-one 5 .
ans = 6
... set <span style="color: #0084C8; font-weight: bold;">/add-one</span> <span style="color: #00578E; font-weight: bold;">&lt;</span> ( add t 1 . ) <span style="color: #0084C8; font-weight: bold;">/t</span> <span style="color: #00578E; font-weight: bold;">&gt;</span> .
... add-one 5 .
ans = 6
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org17ae4d6" class="outline-2">
<h2 id="org17ae4d6"><span class="section-number-2">7</span> Booleans and Control Flow</h2>
<div class="outline-text-2" id="text-7">
<p>
The primary "control flow" operations in ARBEL are <code>if</code> and <code>while</code>.  Control flow in ARBEL is achieved with operations that execute code repeatedly or conditionally.
</p>
</div>

<div id="outline-container-org42397df" class="outline-3">
<h3 id="org42397df"><span class="section-number-3">7.1</span> The if operation</h3>
<div class="outline-text-3" id="text-7-1">
<p>
<code>if</code> takes three arguments.  If its first argument is <code>True</code>, it sets the <code>/ans</code> register to the second argument.  If the third argument is <code>False</code>, it sets the <code>/ans</code> register to the third argument.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/gt-3</span> <span style="color: #00578E; font-weight: bold;">&lt;</span> ( gt t 3 . ) <span style="color: #0084C8; font-weight: bold;">/t</span> <span style="color: #00578E; font-weight: bold;">&gt;</span> .
... set <span style="color: #0084C8; font-weight: bold;">/max-3</span> <span style="color: #00578E; font-weight: bold;">&lt;</span> ( if [ gt-3 t . ] 3 t . ) <span style="color: #0084C8; font-weight: bold;">/t</span> <span style="color: #00578E; font-weight: bold;">&gt;</span> .
... max-3 4 .
ans = 3
... max-3 2 .
ans = 2
</pre>
</div>

<p>
Frequently, we would like to execute some code if a condition is <code>True</code> and another piece of code if a condition is <code>False</code>.  To do this using the <code>if</code> operation, ARBEL uses active instructions.  Because active instructions are only executed if the code attempts to use the value, the statements will not be evaluated unless the <code>if</code> operation attempts to access its second or third argument.  Continuing from the above block of code,
</p>

<div class="org-src-container">
<pre class="src src-arbel">... if [ gt-3 4 . ] { print <span style="color: #4E9A06;">"Greater than 3."</span> . } { print <span style="color: #4E9A06;">"Less than or equal to 3."</span> . } .
Greater than 3.
... if [ gt-3 2 . ] { print <span style="color: #4E9A06;">"Greater than 3."</span> . } { print <span style="color: #4E9A06;">"Less than or equal to 3."</span> . } .
Less than or equal to 3.
... if [ gt-3 3 . ] { print <span style="color: #4E9A06;">"Greater than 3."</span> . } { print <span style="color: #4E9A06;">"Less than or equal to 3."</span> . } .
Less than or equal to 3.
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3b0931" class="outline-3">
<h3 id="orgb3b0931"><span class="section-number-3">7.2</span> The while operation</h3>
<div class="outline-text-3" id="text-7-2">
<p>
<code>while</code> is the other main control flow operation in ARBEL.  <code>while</code> takes two instructions as arguments.  The first instruction is executed first in the current registry.  If the instruction sets the <code>/ans</code> register to <code>True</code>, the second instruction is executed in the current registry as well.  Then, the first instruction is executed again.  If it is <code>True</code>, the second instruction is executed again, and so on.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/i</span> 1 .
... while ( lt i 10 . )
          ( 
            print i . 
            set <span style="color: #0084C8; font-weight: bold;">/i</span> [ add i 1 . ] .
          ) .
1
2
3
4
5
6
7
8
9
</pre>
</div>
</div>
</div>

<div id="outline-container-org1183cb9" class="outline-3">
<h3 id="org1183cb9"><span class="section-number-3">7.3</span> Logical concatenation</h3>
<div class="outline-text-3" id="text-7-3">
<p>
ARBEL also includes logical operations: <code>and</code>, <code>or</code>, and <code>not</code>.  
</p>

<p>
<code>and</code> and <code>or</code> take any number of Boolean arguments.  <code>and</code> sets the <code>/ans</code> register to <code>True</code> if all arguments are <code>True</code> and to <code>False</code> otherwise.  <code>or</code> sets the <code>/ans</code> register to <code>True</code> if any arguments are <code>True</code> and to <code>False</code> otherwise.  Both operations short circuit as soon as the result is clear.  This is only relevant if active expressions are used with <code>and</code> or <code>or</code>.  Because this is the only way that accessing the values has an effect on the program.  This behavior is useful for checking whether some condition is true before executing a command.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/f</span> ( or [ is-integer x . ] 
           { set <span style="color: #0084C8; font-weight: bold;">/x</span> [ add x 1 . ] . answer <span style="color: #F5666D;">True</span> . ] . } . 
             answer x . 
           ) .
... f <span style="color: #0084C8; font-weight: bold;">/x</span> 3.4 .
ans = 3.4
... f <span style="color: #0084C8; font-weight: bold;">/x</span> 10 .
ans = 11
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org14895f4" class="outline-2">
<h2 id="org14895f4"><span class="section-number-2">8</span> Numbers</h2>
<div class="outline-text-2" id="text-8">
<p>
ARBEL has two kinds of numeric data.  It has Real numbers (numbers with a decimal point) and Integer numbers (numbers without a decimal point). 
</p>
</div>

<div id="outline-container-org45597de" class="outline-3">
<h3 id="org45597de"><span class="section-number-3">8.1</span> Arithmetic</h3>
<div class="outline-text-3" id="text-8-1">
<p>
Real and Integer types are different in ARBEL, but the basic arithmetic operations do silently convert between the two.  Whenever both a Real and an Integer are used in arithmetic, the <code>/ans</code> register is a Real number.  The basic arithmetic operations are <code>add</code>, <code>sub</code>, <code>mul</code>, and <code>div</code>.  Dividing two integers gives an integer answer.  
</p>

<div class="org-src-container">
<pre class="src src-arbel">... add 1 2.0 .
ans = 3.0
... sub 4 1 .
ans = 3
... mul 2.5 2 .
ans = 5.0
... div 5 2 .
ans = 2
... div 5.0 2 .
ans = 2.5
</pre>
</div>

<p>
The arithmetic operations can take any number of arguments so that three numbers could be summed by:
</p>

<div class="org-src-container">
<pre class="src src-arbel">... add 5 2 3 .
ans = 10
</pre>
</div>
</div>
</div>

<div id="outline-container-org662811d" class="outline-3">
<h3 id="org662811d"><span class="section-number-3">8.2</span> Comparison</h3>
<div class="outline-text-3" id="text-8-2">
<p>
The numeric comparison operators are <code>gt</code> (greater than), <code>lt</code> (less than), <code>eq</code> (equal to), <code>lt-eq</code> (less than or equal to), and <code>gt-eq</code> (greater than or equal to).  These operations can also take any number of arguments.  These operations set the <code>/ans</code> register to <code>True</code> if the comparison is true and to <code>False</code> if it is false.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... gt 4 3 .
ans = <span style="color: #F5666D;">True</span> 
... gt 10 2 3 4 5 .
ans = <span style="color: #F5666D;">False</span>
... gt 10 5 3 .
ans = <span style="color: #F5666D;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org391f91f" class="outline-3">
<h3 id="org391f91f"><span class="section-number-3">8.3</span> Exponentiation</h3>
<div class="outline-text-3" id="text-8-3">
<p>
The built in operations for exponentiation are <code>exp</code> to compute the natural exponent of a number, <code>log</code> to compute the natural logarithm of a number, and <code>power</code> to raise a number to a given power.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... exp 1 .
ans = 2.718282
... log 2 .
ans = 0.693147
... power 2 0.5 .
ans = 1.414214
</pre>
</div>
</div>
</div>

<div id="outline-container-org60acc39" class="outline-3">
<h3 id="org60acc39"><span class="section-number-3">8.4</span> Modulus</h3>
<div class="outline-text-3" id="text-8-4">
<p>
The modulus operation is <code>mod</code>.  It computes both the Integer and the Real modulus.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... mod 5 2 .
ans = 1
... mod 5.0 2.6
ans = 2.4
</pre>
</div>
</div>
</div>

<div id="outline-container-org9cb1391" class="outline-3">
<h3 id="org9cb1391"><span class="section-number-3">8.5</span> Increment and Decrement</h3>
<div class="outline-text-3" id="text-8-5">
<p>
For efficiency in loops, ARBEL includes operations to increment and decrement Integer values <i>in place</i>, without copying the value.
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> 5 .
... print x .
5
... incr x .
... print x .
6
... decr x .
... print x .
5
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org102a4da" class="outline-2">
<h2 id="org102a4da"><span class="section-number-2">9</span> Strings</h2>
<div class="outline-text-2" id="text-9">
<p>
Strings are ARBEL's data type for handling text data.  A literal string is text enclosed in double-quotes, like so: <code>"hello"</code>.  String literals can include the following escape sequences to input characters that would otherwise be difficult to insert.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Escape Sequence</th>
<th scope="col" class="org-left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\\</td>
<td class="org-left">\</td>
</tr>

<tr>
<td class="org-left">\'</td>
<td class="org-left">' (single-quote)</td>
</tr>

<tr>
<td class="org-left">\t</td>
<td class="org-left">tab</td>
</tr>

<tr>
<td class="org-left">\n</td>
<td class="org-left">newline</td>
</tr>

<tr>
<td class="org-left">\r</td>
<td class="org-left">carriage return</td>
</tr>

<tr>
<td class="org-left">' (single-quote)</td>
<td class="org-left">" (double quote)</td>
</tr>
</tbody>
</table>

<p>
Strings are UTF-8 compliant so Unicode characters are valid characters and will be counted as single characters by string operations.  
</p>
</div>

<div id="outline-container-orgb3ef151" class="outline-3">
<h3 id="orgb3ef151"><span class="section-number-3">9.1</span> String manipulation</h3>
<div class="outline-text-3" id="text-9-1">
<p>
The <code>string-length</code> operation sets the <code>/ans</code> register to the number of characters in the string.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... string-length <span style="color: #4E9A06;">"hello"</span> .
ans = 5
... string-length <span style="color: #4E9A06;">"d&#197;&#181;r"</span> .
ans = 3
</pre>
</div>

<p>
The <code>substring</code> operation sets the <code>/ans</code> register to a substring of <code>string</code> from characters <code>index1</code> to <code>index2</code>.  
</p>

<div class="org-src-container">
<pre class="src src-arbel">substring string index1 index2 .
</pre>
</div>

<p>
ARBEL strings start at position <code>1</code>.  Indexes less than or equal to <code>0</code> have a special meaning.  They count backwards from the last character in the string.  So position <code>0</code> is the last character in the String.  There is no "character" type in ARBEL so <code>substring</code> is the primary way to access elements of strings.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... substring <span style="color: #4E9A06;">"hello"</span> -1 0 .
ans = <span style="color: #4E9A06;">"lo"</span>
... substring <span style="color: #4E9A06;">"hello"</span> 1 2 .
ans = <span style="color: #4E9A06;">"he"</span>
... substring <span style="color: #4E9A06;">"hello"</span> 3 3 .
ans = <span style="color: #4E9A06;">"l"</span>
</pre>
</div>

<p>
ARBEL provides the <code>string-append</code> operation to concatenate strings.  
</p>

<div class="org-src-container">
<pre class="src src-arbel">... string-append <span style="color: #4E9A06;">"hello "</span> <span style="color: #4E9A06;">"world"</span> .
ans = <span style="color: #4E9A06;">"hello world"</span>
</pre>
</div>

<p>
The <code>string-append</code> operation take an arbitrary number of arguments so, the following works as well.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... string-append <span style="color: #4E9A06;">"hello"</span> <span style="color: #4E9A06;">"world"</span> <span style="color: #4E9A06;">"\nhi!"</span> .
ans = <span style="color: #4E9A06;">"helloworld</span>
<span style="color: #4E9A06;">hi!"</span>
</pre>
</div>

<p>
Using the <code>collapse</code> operation with <code>string-append</code> is a useful way to join a list of strings.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... collapse string-append [ list <span style="color: #4E9A06;">"h"</span> <span style="color: #4E9A06;">"e"</span> <span style="color: #4E9A06;">"l"</span> <span style="color: #4E9A06;">"l"</span> <span style="color: #4E9A06;">"o"</span> . ] <span style="color: #0084C8; font-weight: bold;">/t</span> .
ans = <span style="color: #4E9A06;">"hello"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org852202b" class="outline-3">
<h3 id="org852202b"><span class="section-number-3">9.2</span> Regular expressions</h3>
<div class="outline-text-3" id="text-9-2">
<p>
ARBEL implements the POSIX regular expression language using the <code>match</code> and <code>replace</code> operations.  The <code>match</code> operation returns <code>matches</code> in a registry structure and <code>replace</code> sets the <code>/ans</code> register to the original string with all matches replaced with a given replacement string.
</p>

<p>
The syntax for the <code>match</code> operation is:
</p>

<div class="org-src-container">
<pre class="src src-arbel">... match regex string |max matches|
</pre>
</div>

<p>
Where <code>|max matches|</code> is an optional argument denoting the maximum number of matches to return.  By default, it is <code>0</code> which indicates to return all matches.  If it is <code>2</code>, it would return the first two matches.  <code>match</code> sets the <code>/ans</code> registry to a registry that contains a registry for each match that divides the matched string into any groups specified in the regular expression.  For example,
</p>

<div class="org-src-container">
<pre class="src src-arbel">... match <span style="color: #4E9A06;">"el"</span> <span style="color: #4E9A06;">"hello hello"</span> .
ans = a registry with:
t1 of type Registry, value: a registry with:
t0 of type String, value: <span style="color: #4E9A06;">"el"</span>
t2 of type Registry, value: a registry with:
t0 of type String, value: <span style="color: #4E9A06;">"el"</span>
... match <span style="color: #4E9A06;">"(e)(l)"</span> <span style="color: #4E9A06;">"hello hello"</span> .
t1 of type Registry, value: a registry with:
t0 of type String, value: <span style="color: #4E9A06;">"el"</span>
t1 of type String, value: <span style="color: #4E9A06;">"e"</span>
t2 of type String, value: <span style="color: #4E9A06;">"l"</span>
t2 of type Registry, value: a registry with:
t0 of type String, value: <span style="color: #4E9A06;">"el"</span>
t1 of type String, value: <span style="color: #4E9A06;">"e"</span>
t2 of type String, value: <span style="color: #4E9A06;">"l"</span>
</pre>
</div>

<p>
Each match contains the full match at <code>/t0</code> and then the subgroup matches at <code>/tGROUP</code>.
</p>

<p>
The <code>replace</code> operation is similar.  Its syntax is:
</p>

<div class="org-src-container">
<pre class="src src-arbel">... replace regex replacement original-string |max matches|
</pre>
</div>

<p>
The optional <code>|max matches|</code> argument limits the number of replacements to make.  <code>replacement</code> is the string to replace all matches with.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... replace <span style="color: #4E9A06;">"h"</span> <span style="color: #4E9A06;">"e"</span> <span style="color: #4E9A06;">"hello"</span> .
ans = <span style="color: #4E9A06;">"eello"</span> .
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5dc0f50" class="outline-2">
<h2 id="org5dc0f50"><span class="section-number-2">10</span> Files</h2>
<div class="outline-text-2" id="text-10">
<p>
ARBEL provides a File type to manage writing and reading streams of data.  
</p>

<p>
The <code>open-file</code> operation&#x2026; opens a file, setting the <code>/ans</code> register to the resulting file object.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... open-file <span style="color: #4E9A06;">"myfile.txt"</span> .
ans = A file
</pre>
</div>

<p>
To read from the File, we can use the <code>read</code>, <code>read-char</code>, or <code>read-line</code> operations.  The <code>read</code> operation is primarily useful for reading binary data.  It reads a single byte from the file and sets the <code>/ans</code> register to the Integer value of the byte.  <code>read-char</code> and <code>read-line</code> are the primary operations for reading text files.  <code>read-char</code> reads a single character and sets the <code>/ans</code> register to a String result.  <code>read-line</code> reads a full line into a String.  Each of these operations modifies the state of the File.  The next read will grab the next character and so on.  When reading is complete, the read operations set the <code>/ans</code> register to <code>Nothing</code>
</p>

<p>
Suppose the file <code>"myfile.txt"</code> referenced above contained the following line only: <code>hello, world</code>
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/f</span> [ open-file <span style="color: #4E9A06;">"myfile.txt"</span> . ] .
... read f .
ans = 104
... read-char f .
ans = <span style="color: #4E9A06;">"e"</span>
... read-line f .
ans = <span style="color: #4E9A06;">"llo, world"</span>
</pre>
</div>


<p>
Reading-by character works in Unicode as well.  Suppose <code>myfile.txt</code> contains only the word: <code>dr.</code>.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/f</span> [ open-file <span style="color: #4E9A06;">"myfile.txt"</span> . ] .
... read-char f .
ans = <span style="color: #4E9A06;">"d"</span>
... read-char f .
ans = <span style="color: #4E9A06;">"&#373;"</span>
</pre>
</div>

<p>
To close a file, ARBEL provides the <code>close</code> operation.  The <code>close</code> operation takes the register at which the File is located as its argument because ARBEL also needs to remove the File value from the register after closing the file.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/f</span> [ open-file <span style="color: #4E9A06;">"myfile.txt"</span> . ] .
... close <span style="color: #0084C8; font-weight: bold;">/f</span> .
</pre>
</div>
</div>
</div>

<div id="outline-container-org8446b38" class="outline-2">
<h2 id="org8446b38"><span class="section-number-2">11</span> Tasks (concurrent programs)</h2>
<div class="outline-text-2" id="text-11">
<p>
ARBEL can be used to write concurrent (multi-threaded) programs using Task objects.  ARBEL's tasks are a type of data.  You can do everything to them that you can do to other data (move it, delete it, etc).
</p>

<p>
Tasks are created with the <code>task</code> operation.  The <code>task</code> operation takes three arguments.  The first gives the register to assign the Task to.  The second gives the <i>body</i> of the Task, an instruction that the Task will execute when it is run (Tasks do not immediately start running on creation).  The third argument is the initial state of the task, a registry defining the environment in which the task will run.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... task <span style="color: #0084C8; font-weight: bold;">/my-task</span> ( commands to run... ) [ registry . ] .
</pre>
</div>

<p>
Tasks are started with the <code>run-task</code> operation.  <code>run-task</code> takes a single argument, the task to start running.  Running a task means that the instruction that forms the body of the task is executed.  Only one instance of the task can be running at a given time but the same task executed can be executed multiple times (the state of the task will not revert when it is run again).
</p>

<p>
The structure of a task is described in the below table:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Element</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Body</td>
<td class="org-left">The instruction run in a separate thread from the main ARBEL thread.</td>
</tr>

<tr>
<td class="org-left">State</td>
<td class="org-left">A Registry that contains the current state of the task.  The registry being modified by the Task's body.</td>
</tr>

<tr>
<td class="org-left">Queue</td>
<td class="org-left">A Registry that contains data queued to pass from the main thread to the Task's thread or vice-versa.</td>
</tr>
</tbody>
</table>

<p>
A Task's state registry is entirely <i>separate</i> from the current registry.  There is no way to directly access data in a task except in the body of the task.  No data in the Task's queue can be accessed directly in any thread. Data can be sent between the main thread and the task thread using operations.
</p>

<p>
Tasks <i>accept</i> data when they take data from their queue and move it into their state registry.  They can do this with one of three operations: <code>accept</code>, <code>accept-or</code>, and <code>select</code>.
</p>

<p>
The <code>accept</code> operation takes a register as an argument and waits for data to be available at that register in the Task's queue.  A Task can be provided as an optional second argument to look for the data in another task's queue. Once that data is available, it sets the <code>/ans</code> register in the Task's state registry to the value of the data.  <code>accept</code> is <i>blocking</i> so no other code will be executed in the thread running the <code>accept</code> operation until the data is available in the queue.
</p>

<p>
The <code>queue</code> operation moves data from one registry into the queue of another Task.  It tasks a registry to set in the queue registry, the data to use, and the task's queue to access.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... task <span style="color: #0084C8; font-weight: bold;">/t1</span> ( print [ accept <span style="color: #0084C8; font-weight: bold;">/hello</span> . ] . ) .
... run-task t1 .
... queue <span style="color: #0084C8; font-weight: bold;">/hello</span> <span style="color: #4E9A06;">"Hi!"</span> t1 .
Hi!
</pre>
</div>

<p>
Because the <code>accept</code> operation blocks the thread until the data is entered into the queue, it cannot be used when the data is optional.  ARBEL provides two other operations.
</p>

<p>
The <code>accept-or</code> operation checks whether data exists at a certain register in the queue, if it does, it sets the <code>/ans</code> register to the result.  If not, it executes its second argument, an instruction, in its state registry.  This operation does not block.  It checks once if the data is available and otherwise executes the instruction.  For example, in a Task body, we might have:
</p>

<div class="org-src-container">
<pre class="src src-arbel">accept-or <span style="color: #0084C8; font-weight: bold;">/hello</span> ( set <span style="color: #0084C8; font-weight: bold;">/hello</span> <span style="color: #4E9A06;">"Hello."</span> ) .
</pre>
</div>

<p>
The main use of <code>accept-or</code> is to provide default values for missing data or to do something else if data is not available.
</p>

<p>
Alternatively, the <code>select</code> operation executes one of several instructions if data comes in at any number of registers.  <code>select</code> takes paired registers and instructions as its arguments.  It waits for data to appear in its queue at any of the registers listed.  The first register to receive data is "selected".  The instruction associated with the register is executed in the register's state registry after setting the <code>/ans</code> register to the value of the data located at the register in the queue.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... task <span style="color: #0084C8; font-weight: bold;">/t1</span> ( 
                set <span style="color: #0084C8; font-weight: bold;">/continue</span> <span style="color: #F5666D;">True</span> .
                while ( answer continue . )
                      (
                        select <span style="color: #0084C8; font-weight: bold;">/add-one</span> ( print [ add ans 1 . ] . ) 
                               <span style="color: #0084C8; font-weight: bold;">/sub-one</span> ( print [ sub ans 1 . ] . )
                               <span style="color: #0084C8; font-weight: bold;">/continue</span> ( set <span style="color: #0084C8; font-weight: bold;">/continue</span> ans . ) .
                      ) .
             ) .
... run-task t1 .
... queue <span style="color: #0084C8; font-weight: bold;">/add-one</span> 3 t1 .
4
... queue <span style="color: #0084C8; font-weight: bold;">/sub-one</span> 3 t1 .
2
</pre>
</div>
</div>
</div>


<div id="outline-container-org44c23b3" class="outline-2">
<h2 id="org44c23b3"><span class="section-number-2">12</span> Interacting with the User and the Shell</h2>
<div class="outline-text-2" id="text-12">
<p>
One of ARBEL's strengths is in rapidly-developing interactive programs.  ARBEL's syntax is command-like so interaction in such a program can often be done using ARBEL's prompt.  I use a simple program to keep track of my hours at work, an example of this type of program.  These types of programs often require input from the user and the ability to interact with other non-ARBEL programs on the computer.  
</p>

<p>
The <code>input</code> operation accepts input from the user in the same way as ARBEL's usual prompt.  It takes a register as an argument and assigns the String value the user enters to that register in the current registry.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/get-name</span> 
        (
          print <span style="color: #4E9A06;">"What is your name?"</span> .
          input <span style="color: #0084C8; font-weight: bold;">/ans</span> .
        ) .
... get-name .
What is your name?
Zach
ans = <span style="color: #4E9A06;">"Zach"</span>
</pre>
</div>

<p>
To call commands from the shell, use the <code>shell</code> operation.  The <code>shell</code> operation sets the <code>/ans</code> register to a string containing the output of the command.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... shell <span style="color: #4E9A06;">"ls"</span> .
ans = <span style="color: #4E9A06;">"file1.txt</span>
<span style="color: #4E9A06;">file2.txt</span>
<span style="color: #4E9A06;">"</span>
</pre>
</div>

<p>
The <code>change-dir</code> operation changes the working directory of ARBEL and the <code>current-dir</code> operations sets the <code>/ans</code> register to a String giving the current working directory.
</p>

<div class="org-src-container">
<pre class="src src-arbel">... change-dir <span style="color: #4E9A06;">"/home/fzac"</span> .
... current-dir .
ans = <span style="color: #4E9A06;">"/home/fzac"</span> 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf02e86" class="outline-2">
<h2 id="orgcf02e86"><span class="section-number-2">13</span> Examples</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-org90fa2ab" class="outline-3">
<h3 id="org90fa2ab"><span class="section-number-3">13.1</span> Quicksort</h3>
<div class="outline-text-3" id="text-13-1">
<div class="org-src-container">
<pre class="src src-arbel">set <span style="color: #0084C8; font-weight: bold;">/swap</span>
    (
      set <span style="color: #0084C8; font-weight: bold;">/tmp</span> input:i .
      set i input:j input .
      set j tmp input .
    ) .


set <span style="color: #0084C8; font-weight: bold;">/partition</span>
    (
      set <span style="color: #0084C8; font-weight: bold;">/pivot</span> input:end .
      set <span style="color: #0084C8; font-weight: bold;">/i</span> start .
      set <span style="color: #0084C8; font-weight: bold;">/j</span> start .
      set <span style="color: #0084C8; font-weight: bold;">/cont</span> <span style="color: #F5666D;">True</span> .
      while ( answer cont . )
            (
              if [ compare input:j pivot . ]
                 {
                   swap <span style="color: #0084C8; font-weight: bold;">/input</span> input <span style="color: #0084C8; font-weight: bold;">/i</span> i <span style="color: #0084C8; font-weight: bold;">/j</span> j .
                   set <span style="color: #0084C8; font-weight: bold;">/i</span> [ next i . ] .
                 } .

              if [ register-eq j end . ]
                 {
                   set <span style="color: #0084C8; font-weight: bold;">/cont</span> <span style="color: #F5666D;">False</span> .
                 } .

              set <span style="color: #0084C8; font-weight: bold;">/j</span> [ next j . ] .
            ) .

      swap <span style="color: #0084C8; font-weight: bold;">/input</span> input <span style="color: #0084C8; font-weight: bold;">/i</span> i <span style="color: #0084C8; font-weight: bold;">/j</span> end .
      answer i .
    ) .

set <span style="color: #0084C8; font-weight: bold;">/quicksort-internal</span>
    (
      if [ not [ register-eq start end . ] . ]
         {
           partition <span style="color: #0084C8; font-weight: bold;">/input</span> input <span style="color: #0084C8; font-weight: bold;">/start</span> start <span style="color: #0084C8; font-weight: bold;">/end</span> end <span style="color: #0084C8; font-weight: bold;">/compare</span> compare . 
           move <span style="color: #0084C8; font-weight: bold;">/ans</span> <span style="color: #0084C8; font-weight: bold;">/p</span> .
           if [ not [ register-eq p start . ] . ]
              {
                quicksort-internal <span style="color: #0084C8; font-weight: bold;">/input</span> input <span style="color: #0084C8; font-weight: bold;">/start</span> start <span style="color: #0084C8; font-weight: bold;">/end</span> [ previous p . ] .
              } .

           if [ not [ register-eq p end . ] . ]
              {
                quicksort-internal <span style="color: #0084C8; font-weight: bold;">/input</span> input <span style="color: #0084C8; font-weight: bold;">/start</span> [ next p . ] <span style="color: #0084C8; font-weight: bold;">/end</span> end .
              } .
         } .
    ) .

set <span style="color: #0084C8; font-weight: bold;">/quicksort</span>
    (
      if [ not [ exist <span style="color: #0084C8; font-weight: bold;">/end</span> . ] . ]
         {
           set <span style="color: #0084C8; font-weight: bold;">/end</span> [ last input slice . ] .
         } .
      if [ not [ exist <span style="color: #0084C8; font-weight: bold;">/start</span> . ] . ]
         {
           set <span style="color: #0084C8; font-weight: bold;">/start</span> [ next slice . ] . 
         } .

      if [ not [ exist start input . ] . ]
         {
           error <span style="color: #4E9A06;">"Starting register not found in input."</span> .
         } .

      if [ not [ exist end input . ] . ]
         {
           error <span style="color: #4E9A06;">"Ending register not found in input."</span> .
         } .

      quicksort-internal <span style="color: #0084C8; font-weight: bold;">/input</span> input <span style="color: #0084C8; font-weight: bold;">/start</span> start <span style="color: #0084C8; font-weight: bold;">/end</span> end <span style="color: #0084C8; font-weight: bold;">/compare</span> compare .
    ) .
</pre>
</div>

<p>
Example of use:
</p>

<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/x</span> [ list 3 2 4 1 . ] .
... quicksort <span style="color: #0084C8; font-weight: bold;">/input</span> x <span style="color: #0084C8; font-weight: bold;">/slice</span> <span style="color: #0084C8; font-weight: bold;">/t</span> <span style="color: #0084C8; font-weight: bold;">/compare</span> lt .
... print x .
ans = a registry with:
t1 of type Integer, value: 1
t2 of type Integer, value: 2
t3 of type Integer, value: 3
t4 of type Integer, value: 4
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bc66cd" class="outline-3">
<h3 id="org1bc66cd"><span class="section-number-3">13.2</span> A Line-Oriented Text Editor</h3>
<div class="outline-text-3" id="text-13-2">
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' Line-oriented text editor</span>
set <span style="color: #0084C8; font-weight: bold;">/arbed</span> [ registry . ] .
in arbed
   (
     set <span style="color: #0084C8; font-weight: bold;">/buffer</span> [ list . ] . 
     set <span style="color: #0084C8; font-weight: bold;">/cur-line</span> 1 . 
     set <span style="color: #0084C8; font-weight: bold;">/n</span> ( up set <span style="color: #0084C8; font-weight: bold;">/cur-line</span> [ add cur-line 1 . ] . ) .
     set <span style="color: #0084C8; font-weight: bold;">/p</span> ( up set <span style="color: #0084C8; font-weight: bold;">/cur-line</span> [ sub cur-line 1 . ] . ) .
     set <span style="color: #0084C8; font-weight: bold;">/i</span>
         [ op
             (
               set <span style="color: #0084C8; font-weight: bold;">/arbed-str</span> s buffer .
               in buffer
                  (
                    to-register cur-line .
                    set ans arbed-str .
                  ) .
             )
             <span style="color: #0084C8; font-weight: bold;">/s</span> . ] .
     set <span style="color: #0084C8; font-weight: bold;">/o</span>
         (
           to-register cur-line . 
           print [ get ans buffer . ] .
         ) .
   ) .
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... go-in arbed .
... i <span style="color: #0084C8; font-weight: bold;">/s</span> <span style="color: #4E9A06;">"Hello"</span> .
... o .
Hello
... n .
... i <span style="color: #0084C8; font-weight: bold;">/s</span> <span style="color: #4E9A06;">"Goodbye"</span> .
... o .
Goodbye
... p .
... o .
Hello
</pre>
</div>
</div>
</div>

<div id="outline-container-org75981f5" class="outline-3">
<h3 id="org75981f5"><span class="section-number-3">13.3</span> Numerical Differentiation</h3>
<div class="outline-text-3" id="text-13-3">
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' Compute the numerical derivative of an operation that takes an arg</span>
set <span style="color: #0084C8; font-weight: bold;">/deriv</span>
    (
      if [ not [ exist <span style="color: #0084C8; font-weight: bold;">/h</span> . ] . ]
         {
           set <span style="color: #0084C8; font-weight: bold;">/h</span> 0.001 .
         } .
      div [ sub [ f [ add x h . ] . ]
                [ f [ sub x h . ] . ] . ]
          [ mul 2 h . ] .
    ) .
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/f</span> ( power t 2 . ) .
... deriv <span style="color: #0084C8; font-weight: bold;">/f</span> f <span style="color: #0084C8; font-weight: bold;">/x</span> 1.0
ans = 2.0
</pre>
</div>
</div>
</div>

<div id="outline-container-org16271c2" class="outline-3">
<h3 id="org16271c2"><span class="section-number-3">13.4</span> Compute Factorial</h3>
<div class="outline-text-3" id="text-13-4">
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' compute a factorial using while</span>
set <span style="color: #0084C8; font-weight: bold;">/factorial</span>
    (
      set <span style="color: #0084C8; font-weight: bold;">/i</span> 2 .
      set <span style="color: #0084C8; font-weight: bold;">/prod</span> 1 .
      while ( lt-eq i t . )
            (
              set <span style="color: #0084C8; font-weight: bold;">/prod</span> [ mul i prod . ] .
              set <span style="color: #0084C8; font-weight: bold;">/i</span> [ add i 1 . ] .
            ) .
      answer prod .
    ) .


<span style="color: #204A87;">' compute factorial using recursion</span>

set <span style="color: #0084C8; font-weight: bold;">/factorial-recurse</span>
    (
      if [ eq t 1 . ]
         1
         {
           mul t [ factorial-recurse <span style="color: #0084C8; font-weight: bold;">/t</span> [ sub t 1 . ] . ] .
         } .
    ) .
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... factorial 5 .
ans = 120
</pre>
</div>
</div>
</div>

<div id="outline-container-org78d54fa" class="outline-3">
<h3 id="org78d54fa"><span class="section-number-3">13.5</span> Numerical Integration</h3>
<div class="outline-text-3" id="text-13-5">
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' takes an operation as an argument and return left hand</span>
<span style="color: #204A87;">' riemmann sum over range</span>

set <span style="color: #0084C8; font-weight: bold;">/integrate</span> 
    ( 
      set <span style="color: #0084C8; font-weight: bold;">/delta</span> [ div [ sub ub lb . ] n . ] .
      set <span style="color: #0084C8; font-weight: bold;">/x</span> lb .
      set <span style="color: #0084C8; font-weight: bold;">/int</span> 0.0 .
      repeat n
             (
               incr int [ f x . ] .
               incr x delta .
             ) .
      mul int delta .
    ) .
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... integrate <span style="color: #0084C8; font-weight: bold;">/f</span> ( power t 2 . ) <span style="color: #0084C8; font-weight: bold;">/lb</span> 0.0 <span style="color: #0084C8; font-weight: bold;">/ub</span> 1.0 <span style="color: #0084C8; font-weight: bold;">/n</span> 1000 .
ans = 0.332834
</pre>
</div>
</div>
</div>

<div id="outline-container-orga852616" class="outline-3">
<h3 id="orga852616"><span class="section-number-3">13.6</span> Basic Linear Algebra</h3>
<div class="outline-text-3" id="text-13-6">
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' Computes v^T w for a vector </span>
set <span style="color: #0084C8; font-weight: bold;">/dotproduct</span>
    (
      do mul v w .
      collapse add ans  .
    ) .

<span style="color: #204A87;">' matrix-multiply A B computes A^T B</span>
set <span style="color: #0084C8; font-weight: bold;">/matrix-multiply</span>
    (
      set <span style="color: #0084C8; font-weight: bold;">/i</span> <span style="color: #0084C8; font-weight: bold;">/t1</span> .
      set <span style="color: #0084C8; font-weight: bold;">/out</span> [ list . ] .
      while ( exist i B . )
            (
              do <span style="color: #00578E; font-weight: bold;">&lt;</span> ( dotproduct <span style="color: #0084C8; font-weight: bold;">/v</span> t1 <span style="color: #0084C8; font-weight: bold;">/w</span> B:i . ) <span style="color: #0084C8; font-weight: bold;">/t1</span> <span style="color: #00578E; font-weight: bold;">&gt;</span> A .
              in out ( set i ans . ) .
              next i .
              move <span style="color: #0084C8; font-weight: bold;">/ans</span> <span style="color: #0084C8; font-weight: bold;">/i</span> .
            ) .
      answer out .
    ) .

<span style="color: #204A87;">' Computes A^T </span>
set <span style="color: #0084C8; font-weight: bold;">/transpose</span>
    (
      set <span style="color: #0084C8; font-weight: bold;">/i</span> <span style="color: #0084C8; font-weight: bold;">/t1</span> .
      set <span style="color: #0084C8; font-weight: bold;">/out</span> [ list . ] .
      while ( exist i A:<span style="color: #0084C8; font-weight: bold;">/t1</span> . )
            (
              do <span style="color: #00578E; font-weight: bold;">&lt;</span> ( answer t1:i . ) <span style="color: #0084C8; font-weight: bold;">/t1</span> <span style="color: #00578E; font-weight: bold;">&gt;</span> A .
              move <span style="color: #0084C8; font-weight: bold;">/ans</span> <span style="color: #0084C8; font-weight: bold;">/res</span> .
              in out ( set i res . ) .
              next i .
              move <span style="color: #0084C8; font-weight: bold;">/ans</span> <span style="color: #0084C8; font-weight: bold;">/i</span> .
            ) .
      answer out .
    ) .
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... set <span style="color: #0084C8; font-weight: bold;">/A</span> [ list [ list 1 2 . ] [ list 3 4 . ] . ] .
... set <span style="color: #0084C8; font-weight: bold;">/B</span> [ list [ list 6 2 . ] [ list 3 4 . ] . ] .
... transpose <span style="color: #0084C8; font-weight: bold;">/A</span> A .
ans = a registry with:
t1 of type Registry, value: a registry with:
t1 of type Integer, value: 1
t2 of type Integer, value: 3
t2 of type Registry, value: a registry with:
t1 of type Integer, value: 2
t2 of type Integer, value: 4
... matrix-multiply <span style="color: #0084C8; font-weight: bold;">/A</span> A <span style="color: #0084C8; font-weight: bold;">/B</span> B .
ans = a registry with:
t1 of type Registry, value: a registry with:
t1 of type Integer, value: 10
t2 of type Integer, value: 26
t2 of type Registry, value: a registry with:
t1 of type Integer, value: 11
t2 of type Integer, value: 25
</pre>
</div>
</div>
</div>

<div id="outline-container-org48bce83" class="outline-3">
<h3 id="org48bce83"><span class="section-number-3">13.7</span> Split a String</h3>
<div class="outline-text-3" id="text-13-7">
<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' Tokenize a string /line by splitting on string /sep</span>
set <span style="color: #0084C8; font-weight: bold;">/tokenize</span>
    (
      set <span style="color: #0084C8; font-weight: bold;">/i</span> 1 .
      set <span style="color: #0084C8; font-weight: bold;">/len</span> [ string-length line . ] .
      set <span style="color: #0084C8; font-weight: bold;">/cur-reg</span> <span style="color: #0084C8; font-weight: bold;">/t1</span> .
      set <span style="color: #0084C8; font-weight: bold;">/tokened</span> [ list . ] .
      set <span style="color: #0084C8; font-weight: bold;">/init</span> 1 .
      while ( lt-eq i len . )
            (
              set <span style="color: #0084C8; font-weight: bold;">/d</span> [ substring line i i . ] .
              if [ string-eq d sep . ]
                 {
                   in tokened ( set cur-reg buffer . ) .
                   set <span style="color: #0084C8; font-weight: bold;">/cur-reg</span> [ next cur-reg . ] .
                   set <span style="color: #0084C8; font-weight: bold;">/init</span> 1 .
                 }
                 {
                   if [ eq init 1 . ] { set <span style="color: #0084C8; font-weight: bold;">/buffer</span> d . set <span style="color: #0084C8; font-weight: bold;">/init</span> 0 . }
                      { set <span style="color: #0084C8; font-weight: bold;">/buffer</span> [ string-append buffer d . ] . } .
                 } .
              set <span style="color: #0084C8; font-weight: bold;">/i</span> [ add i 1 . ] .
            ) .
      in tokened ( set cur-reg buffer . ) .
      answer tokened .
    )  .
</pre>
</div>

<p>
Examples of use:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... tokenize <span style="color: #0084C8; font-weight: bold;">/line</span> <span style="color: #4E9A06;">"1,2,3"</span> <span style="color: #0084C8; font-weight: bold;">/sep</span> <span style="color: #4E9A06;">","</span> .
ans = a registry with:
t1 of type String, value: 1
t2 of type String, value: 2
t3 of type String, value: 3
</pre>
</div>
</div>
</div>

<div id="outline-container-org06fad91" class="outline-3">
<h3 id="org06fad91"><span class="section-number-3">13.8</span> Linking C code</h3>
<div class="outline-text-3" id="text-13-8">
<p>
It is possible to write ARBEL operations in C, using ARBEL's <code>link</code> operation to import the code.
</p>

<p>
The following is an example of C code.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #204A87;">/* </span>
<span style="color: #204A87;">   A C Function to compute log(x+1) </span>
<span style="color: #204A87;">*/</span>

<span style="color: #A020F0;">#include</span> <span style="color: #4E9A06;">"../src/arbel.h"</span>
<span style="color: #A020F0;">#include</span> <span style="color: #4E9A06;">&lt;math.h&gt;</span>
<span style="color: #2F8B58; font-weight: bold;">void</span>
<span style="color: #00578E; font-weight: bold;">log_plus_one</span> (<span style="color: #2F8B58; font-weight: bold;">arg</span> <span style="color: #0084C8; font-weight: bold;">a</span>, <span style="color: #2F8B58; font-weight: bold;">registry</span>* <span style="color: #0084C8; font-weight: bold;">reg</span>)
{
  check_length(&amp;a, 1, <span style="color: #4E9A06;">"log1"</span>);
  <span style="color: #A52A2A; font-weight: bold;">if</span> (is_error(-1)) <span style="color: #A52A2A; font-weight: bold;">return</span>;

  <span style="color: #2F8B58; font-weight: bold;">data</span>* <span style="color: #0084C8; font-weight: bold;">arg1</span> = resolve(a.arg_array[1], reg);

  <span style="color: #A52A2A; font-weight: bold;">if</span> (arg1 == <span style="color: #F5666D;">NULL</span>)
    {
      do_error(<span style="color: #4E9A06;">"&lt;log1&gt; requires an argument."</span>);
      <span style="color: #A52A2A; font-weight: bold;">return</span>;
    }

  <span style="color: #A52A2A; font-weight: bold;">if</span> (arg1-&gt;type != Integer &amp;&amp; arg1-&gt;type != Real)
    {
      do_error(<span style="color: #4E9A06;">"Argument to &lt;log1&gt; must be numeric."</span>);
      <span style="color: #A52A2A; font-weight: bold;">return</span>;
    }

  <span style="color: #2F8B58; font-weight: bold;">double</span> <span style="color: #0084C8; font-weight: bold;">ans</span>;
  <span style="color: #A52A2A; font-weight: bold;">if</span> (arg1-&gt;type == Integer)
    {
      ans = log(*((<span style="color: #2F8B58; font-weight: bold;">int</span>*) arg1-&gt;data) + 1.0);
    }
  <span style="color: #A52A2A; font-weight: bold;">else</span>
    {
      ans = log(*((<span style="color: #2F8B58; font-weight: bold;">double</span>*) arg1-&gt;data) + 1.0);
    }

  <span style="color: #2F8B58; font-weight: bold;">data</span>* <span style="color: #0084C8; font-weight: bold;">d</span>;
  assign_real(&amp;d, ans);
  ret_ans(reg,d);
}
</pre>
</div>

<p>
We then compile it into a shared object file, linking against <code>libarbel</code>.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #204A87;">#</span><span style="color: #204A87;">!/bin/</span><span style="color: #A52A2A; font-weight: bold;">sh</span>

<span style="color: #204A87;">## </span><span style="color: #204A87;">Assumes you have already make installed arbel so that libarbel is on your path and that the</span>
<span style="color: #204A87;">## </span><span style="color: #204A87;">library is installed in /usr/local/lib.  Modify path if installed elsewhere.</span>

gcc -c -fPIC -o link.o link.c
gcc -shared -Wl,-rpath -Wl,/usr/local/lib -o link.so link.o -larbel
</pre>
</div>

<p>
The code then can be loaded into ARBEL with the <code>link</code> operation like so:
</p>

<div class="org-src-container">
<pre class="src src-arbel"><span style="color: #204A87;">' Demonstrates linking C code in</span>
link <span style="color: #4E9A06;">"./link.so"</span> <span style="color: #4E9A06;">"log_plus_one"</span> <span style="color: #4E9A06;">"log1"</span> .
</pre>
</div>

<p>
The first argument of <code>link</code> gives the shared-object file name.  The second argument gives the name of the function.  The third argument gives what the name of the ARBEL operation will be.
</p>

<p>
Now, the operation can be called in the following way:
</p>
<div class="org-src-container">
<pre class="src src-arbel">... log1 1 .
ans = 0.693147
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Zach Flynn</p>
<p class="date">Created: 2020-09-12 Sat 13:51</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
